#!/bin/bash

ARGS="--verbose --rank=0 --size=1 --hostlist=localhost \
--plugins=modctl,api,barrier,kvs,log,hb,job,event,log,sim,submit,sim_sched,sim_exec \
kvs:conf.hb.period-sec=1.5 kvs:conf.log.reduction-timeout-msec=100 \
kvs:conf.log.circular-buffer-entries=100000 kvs:conf.log.persist-level=debug \
sim_sched:rdl-conf=conf/hype.lua submit:job-csv=simulator/job_data/hype.csv"

#	 --logdest=cmbd.log \

if [ "$1" == "totalview" ]; then
	totalview ./cmbd -a $ARGS
elif [ "$1" == "totalviewcli" ]; then
	totalviewcli ./cmbd -a "$ARGS"
elif [ "$1" == "memscape" ]; then
	memscape ./cmbd -a $ARGS
elif [ "$1" == "gdb" ]; then
	gdb --args ./cmbd $ARGS
else
	OUTPUT_NUM=0
	while [ -f "./output."$OUTPUT_NUM".txt" ]; do
		OUTPUT_NUM=$(($OUTPUT_NUM + 1))
	done
	./cmbd $ARGS &> "./output."$OUTPUT_NUM".txt"
fi
